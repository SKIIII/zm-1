{template "zyorder","top-head"}
<link rel="stylesheet" href="//at.alicdn.com/t/font_1180984_6azux45wb7b.css">
<style>
	p{
		padding-right: 0.1rem;
	}
	::-webkit-input-placeholder { /* WebKit browsers */
		color:    #999;
	}
	:-moz-placeholder { /* Mozilla Firefox 4 to 18 */
		color:    #999;
	}
	::-moz-placeholder { /* Mozilla Firefox 19+ */
		color:    #999;
	}
	:-ms-input-placeholder { /* Internet Explorer 10+ */
		color:    #999;
	}
	.order-content{
		vertical-align: middle;
	}
	.goods-content{
		font-size: 0.13rem;
		padding: 0.1rem	;
	}
	.goods-content span{
		color: grey;
	}
	.goods-content input{
		background-color:transparent;
		border:0;
	}
	.sh-div {
		margin: 0.1rem 0.1rem 0rem 0.1rem;
		background: #fff;
	}
	.sh-item{
		padding:0.1rem 0rem 0.1rem 0.1rem;
	}
	.sh-item p{
		display: inline-block;
		font-size: .13rem;
		vertical-align: middle;
	}
	.sh-item span{
		color: #df5000;
		font-size: .3rem;

	}
	.sh-item2{
		padding: 0.1rem 0.1rem 0.1rem 0rem;
		height:0.25rem;
		line-height:0.2rem;
	}
	.sh-item2 p{
		display: inline-block;
		font-size: .13rem;
		height:0.25rem;
		line-height:0.2rem;
	}
	.sh-item2 span{
		color: grey;
		font-size: .3rem;
	}

</style>
<style>
	.layui-rate { padding: 0 !important; margin-top: -0.06rem; }
	span.layui-inline { margin-top: -0.06rem; }
	.layui-upload-list img { width: 1rem; }
	.photoShow{white-space: nowrap}
	.layui-col-xs3 .layui-upload-img { width: 70px; height:  70px; object-fit: cover; }

</style>
<style>
	.none{
		display: none;
	}
	.select1{
		height: 2rem;
		padding: 0 0.1rem 0 0.1rem;
		background-color: #fff;
	}
	.select1 input{
		display: inline-block;
	}
	.select1{display: none;}

	.select1 .rel{
		position: relative;
	}
	.select1 h5{
		padding: 0.1rem;
		font-size: 0.16rem;
	}
	.select2{
		height: 2rem;
		padding: 0 0.1rem 0 0.1rem;
		background-color: #fff;
	}
	.select2 input{
		display: inline-block;
	}
	.select2{display: none;}

	.select2 .rel{
		position: relative;
	}
	.select2 h5{
		padding: 0.1rem;
		font-size: 0.16rem;
	}
	.input-block{
		width: 100%;
		margin: 0;
		vertical-align: middle;
	}
	.input-block input{
		float: right;
	}
	.input-block span{
		font-size: 0.14rem;
	}
	.layui-form-item{
		margin: 0;
	}
	.goods-tcn{
		position: relative;
	}

	 .layui-layer-page .layui-layer-content{overflow: inherit !important}
	 .layui-layer-setwin .layui-layer-close2 {right: -.1rem}
</style>
<style>
	.goods-tcn-num-add {
		text-align: center;
	}
	.goods-tcn-num-add span {
		display: inline-block;
		width: .2rem;
		line-height: .2rem;
		background-color: #e6e6e6;
		text-align: center;
		font-size: .15rem;
	}
	.goods-tcn-num-add input {
		width: .3rem;
		line-height: .2rem;
		border-style: none;
		text-align: center;
	}
	input[type="number"] {
		-moz-appearance: textfield;
	}
</style>
<body class="bg-f4f4f4">
	<div class="personal-head" >
		<a onclick="javascript :history.back(-1);">
			<div class="fl head-icon">
				<i class="layui-icon layui-icon-left"></i>
			</div>
		</a>
		<div class="fl head-icon">
		</div>
		<div class="title">
			<span>申请退款</span>
		</div>
		<div class="fr head-icon">
		</div>
		<div class="fr head-icon">
		</div>
	</div>
	<div style="height: .29rem;"></div>

	<div class="order_info">
		<div class="order-div" style="margin: 0; margin-top:0.1rem;">
			<!--订单内容-->
			<template  v-for="info in data">
			<div class="order-content">
				<!--<a :href="'index.php?m=hpshop&c=index&a=goodsinfo&id='+info.goods_id" class="d-b">-->
					<div class="fl order-shop-w1">
						<img :src="info.goods_img">
					</div>
					<div class="fl order-shop-w2">
						<p>{{ info.goods_name }}</p>
						<p class="p2">{{ info.specid_name }}</p>
					</div>
					<div class="clear"></div>
				<!--</a>-->

			</div>
			<hr style="margin:0">
			</template>

		</div>
	</div>

	<form action="index.php?m=zyorder&c=index&a=afterSaleApi" name="myform" method="post">
	<div class="goods_info">
		<div class="sh-div" style="margin: 0; margin-top:0.1rem;">
			<div class="goods-content" @click="goods_status()">
				<div class="fl" >
					<p >货物状态</p>
				</div>
				<div class="fr" >
					<span class="status">请选择</span>
					<span class="iconfont icon-icon-test3"></span>
				</div>
				<div class="clear"></div>
			</div>
			<hr style="margin:0">
			<div class="goods-content" @click="tuikuan()">
				<div class="fl" >
					<p >退款原因</p>
				</div>
				<div class="fr" >
					<span class="reason">请选择</span>
					<span class="iconfont icon-icon-test3"></span>
				</div>
				<div class="clear"></div>
			</div>
			<hr style="margin:0">
			<div class="goods-content">
				<div class="fl" >
					<p >退款金额</p>
				</div>
				<div class="fl" >
					<span style="color: red">￥</span>
					<span id="return_price"  style="color: red" >{{s_price}}</span>
					<!--<input id="return_price" type="text" style="color: red" placeholder="填写金额" :value="data[0].goods_price*data[0].goods_num">-->
				</div>
				<div class="fr" >
					<div class="goods-tcn-num">
						<div class="goods-tcn-num-add">
							<input type="hidden" :name="changeName('shop', order_goods_id, 'number')" :value="s_shuliang">
							<span class="jian" v-on:click="jiannum">-</span>
							<span style="background: #fff;font-size: 0.14rem">{{s_shuliang}}</span>
							<span class="jia" v-on:click="jianum" >+</span>
						</div>
						<div class="clear"></div>
					</div>
				</div>
				<div style="height: 0.3rem"></div>
				<div class="clear"></div>
				<div class="fl" >
					<p >退款说明</p>
				</div>
				<div class="fl	" >
					<input type="text" :name="changeName('shop', order_goods_id, 'remark')" placeholder="选填">
				</div>
				<div class="clear"></div>
				<input type="hidden" name="order_id" :value="order_id">
			</div>
		</div>
	</div>

	<div class="img_info">
		<div class="sh-div" style="margin: 0; margin-top:0.1rem;">

			<div class="goods-content">
				<div class="fl" >
					<p >上传凭证</p>
				</div>
				<div class="clear"></div>
			</div>
			<ul style="background:#fff;border-top:1px solid #f1f1f1;padding:10px 0;">
				<li>
					<div class="layui-form-item primary-item" style="margin-bottom:0;">
						<label class="layui-form-label primary-label-1">图片展示<span class="layui-badge-dot"></span></label>
						<div class="layui-input-block text-left ">
							<button type="button" class="layui-btn layui-btn-sm" id="upload_img" style="margin-top: 0.035rem;">多图片上传</button>
						</div>
					</div>
				</li>
				<li>
					<div class="layui-upload pl05 pr05 ">
						<div class="layui-upload-list" id="demo"><div class="layui-row layui-col-space10 photoShow"></div><div class="clear"></div></div>
					</div>
				</li>
			</ul>
			<button id="btn" type="button" hidden>ssss</button>
			<div class="clear"></div>
		</div>
	</div>
	<button class="layui-btn layui-btn-danger layui-btn-fluid" style="position: absolute; bottom: 0;" type="submit" value="dosubmit" id="dosubmit">提交</button>
	</form>
	<div style="height: 0.1rem"></div>

	<div class="layui-container select1" >
		<div class="goods-tcn">
		<h5 style="text-align: center">货物状态</h5>
			<!--<form class="layui-form" action="">-->
		<div class="layui-form-item">
			<div class="input-block fr">
				<span class="fl">已收到货</span><input type="radio" name="goods_status" value="已收到货" title="已收到货" >
			</div>
		</div>
		<hr>
		<div class="layui-form-item">
			<div class="input-block fr">
				<span class="fl">未收到货</span><input type="radio" name="goods_status" value="未收到货" title="未收到货" >
			</div>
		</div>
			<!--</form>-->
		<!--<button class="layui-btn layui-btn-danger layui-btn-fluid" style="position:fixed; bottom: 0;width: 95%" type="button" @click="shut()">关闭</button>-->
		</div>
	</div>

	<div class="layui-container select2" >
		<div class="goods-tcn">
			<!--<form class="layui-form" action="">-->

			<!--</form>-->
			<!--<button class="layui-btn layui-btn-danger layui-btn-fluid" style="position:fixed; bottom: 0;width: 95%" type="button" @click="shut()">关闭</button>-->
		</div>
	</div>
    {template "hpshop","footer"}
    
    <script>
	$(function(){
        //由于模块都一次性加载，因此不用执行 layui.use() 来加载对应模块，直接使用即可：
        ;
        ! function () {
			var layer = layui.layer
					, form = layui.form
					, $ = layui.jquery
					, upload = layui.upload
					, table = layui.table;

			var id = '{$_GET[order_goods_id]}';
			var status = '{$_GET[status]}';
			if(status==2){
				parent.$('.status').text('未收到货');
				parent.$('.status').css("color","black");
				parent.$('.status').parent().append('<input type="hidden" name="shop['+id+'][goodsType]" value="未收到货">');
				$('.status').parent().parent().hide();
			}
			if(id){
				aj.post('index.php?m=zyorder&c=zyorder_api&a=one_goods_info',{order_goods_id:id},function(data){
					if(data.status =='success'){
						var order_info = new Vue({
							el: '.order_info',
							data: data,
							methods:{

							}
						});
						var goods_info = new Vue({
							el: '.goods_info',
							data: {
								data:data,
								s_shuliang: "1",
								s_price:data.data[0].goods_price,
								max_sum:data.data[0].goods_num,
								order_goods_id:id,
								order_id:data.data[0].order_id,
							},
							methods:{
								changeName:function(str, index, name){
									return str+'['+index+']'+'['+name+']';
								},
								//货物状态
								goods_status(){
									console.log('货物状态');
									layer.open({
										type: 1,
										area: ['100%', 'auto'],
										offset: 'b',
										//closeBtn: 0,
										anim: 2,
										title: false, //不显示标题
										shadeClose: true,
										isOutAnim: false,
										scrollbar: true,
										move:true,
										fixed:false,
										content: $('.select1'), //捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响
										end: function () {
											//location.reload();
											$('.select1').hide();
										},
									});
								},
								tuikuan(){
									var goods_status=$('.status').text();
									console.log(goods_status);
									if(goods_status!='请选择') {
										if(goods_status=='已收到货'){

											$('.select2').children().empty();
											var content='<h5 style="text-align: center">退款原因</h5>';
											content+='<div class="layui-form-item"> <div class="input-block fr"> <span class="fl">效果不好/不想要/不喜欢</span><input type="radio" name="tuikuan_reason" value="效果不好/不想要/不喜欢" title="效果不好/不想要/不喜欢" > </div> </div> <hr>';
											content+='<div class="layui-form-item"> <div class="input-block fr"> <span class="fl">材质不符</span><input type="radio" name="tuikuan_reason" value="材质不符" title="材质不符" > </div> </div> <hr>';
											content+='<div class="layui-form-item"> <div class="input-block fr"> <span class="fl">尺寸问题</span><input type="radio" name="tuikuan_reason" value="尺寸问题" title="尺寸问题" > </div> </div> <hr>';
											content+='<div class="layui-form-item"> <div class="input-block fr"> <span class="fl">做工瑕疵</span><input type="radio" name="tuikuan_reason" value="做工瑕疵" title="做工瑕疵" > </div> </div> <hr>';
											content+='<div class="layui-form-item"> <div class="input-block fr"> <span class="fl">颜色/款式/图案与描述不符</span><input type="radio" name="tuikuan_reason" value="颜色/款式/图案与描述不符" title="颜色/款式/图案与描述不符" > </div> </div> <hr>';
											content+='<div class="layui-form-item"> <div class="input-block fr"> <span class="fl">主商品破损</span><input type="radio" name="tuikuan_reason" value="主商品破损" title="主商品破损" > </div> </div> <hr>';
											content+='<div class="layui-form-item"> <div class="input-block fr"> <span class="fl">配件破损</span><input type="radio" name="tuikuan_reason" value="配件破损" title="配件破损" > </div> </div> <hr>';
											content+='<div class="layui-form-item"> <div class="input-block fr"> <span class="fl">卖家发错货</span><input type="radio" name="tuikuan_reason" value="卖家发错货" title="卖家发错货" > </div> </div> <hr>';
											content+='<div class="layui-form-item"> <div class="input-block fr"> <span class="fl">假冒品牌</span><input type="radio" name="tuikuan_reason" value="假冒品牌" title="假冒品牌" > </div> </div> <hr>';
											content+='<div class="layui-form-item"> <div class="input-block fr"> <span class="fl">其他</span><input type="radio" name="tuikuan_reason" value="其他" title="其他" > </div> </div> <hr>';
											content+='<div class="layui-form-item"> <div class="input-block fr">  </div> </div>';
											$('.select2').children().append(content);
											layer.open({
												type: 1,
												area: ['100%', 'auto'],
												offset: 'b',
												//closeBtn: 0,
												anim: 2,
												title: false, //不显示标题
												shadeClose: true,
												isOutAnim: false,
												scrollbar: true,
												move: true,
												fixed: false,
												content: $('.select2'), //捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响
												end: function () {
													$('.select2').hide();
												},
											});
										}else if(goods_status=='未收到货'){
											$('.select2').children().empty();
											var content='<h5 style="text-align: center">退款原因</h5>';
											content+='<div class="layui-form-item"> <div class="input-block fr"> <span class="fl">多拍/拍错/不想要</span><span class="none">111</span></span><input type="radio" name="tuikuan_reason" value="多拍/拍错/不想要" title="多拍/拍错/不想要" > </div> </div> <hr>';
											content+='<div class="layui-form-item"> <div class="input-block fr"> <span class="fl">快递一直未到</span><span class="none">222</span><input type="radio" name="tuikuan_reason" value="快递一直未到" title="快递一直未到" > </div> </div> <hr>';
											content+='<div class="layui-form-item"> <div class="input-block fr"> <span class="fl">未按约定时间发货</span><span class="none">333</span><input type="radio" name="tuikuan_reason" value="未按约定时间发货" title="未按约定时间发货" > </div> </div> <hr>';
											content+='<div class="layui-form-item"> <div class="input-block fr"> <span class="fl">快递无跟踪记录</span><span class="none">444</span><input type="radio" name="tuikuan_reason" value="快递无跟踪记录" title="快递无跟踪记录" > </div> </div> <hr>';
											content+='<div class="layui-form-item"> <div class="input-block fr"> <span class="fl">空包裹/少货</span><span class="none">555</span><input type="radio" name="tuikuan_reason" value="空包裹/少货" title="空包裹/少货" > </div> </div> <hr>';
											content+='<div class="layui-form-item"> <div class="input-block fr"> <span class="fl">其他</span><span class="none">666</span><input type="radio" name="tuikuan_reason" value="其他" title="其他" > </div> </div><hr> ';
											content+='<div class="layui-form-item"> <div class="input-block fr">  </div> </div>';
											$('.select2').children().append(content);
											layer.open({
												type: 1,
												area: ['100%', 'auto'],
												offset: 'b',
												//closeBtn: 0,
												anim: 2,
												title: false, //不显示标题
												shadeClose: true,
												isOutAnim: false,
												scrollbar: true,
												move: true,
												fixed: false,
												content: $('.select2'), //捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响
												end: function () {
													$('.select2').hide();
												},
											});
										}else{
											layer.msg('非法参数');
										}

									}
								},
								huanhuo(){
									console.log();
//									setTimeout("javascript:location.href='index.php?m=zyorder&c=index&a=aftersale&order_goods_id="+id+"'",0);
								},
								shut(){
									document.body.style.top = `0px`;
									document.body.style.position = 'static';
									layer.closeAll();
								},
								select_status:function(data){
									this.type_info = data;
										console.log(data);
										$('.status').text('我被改变了');
										layer.close();
								},
								jiannum: function () {
									if(this.s_shuliang<2){
										this.s_shuliang = "1";
										layer.msg('不能再减了');
									}else{
										this.s_shuliang --;
										this.s_price =toDecimal(Number(this.s_price)-Number(data.data[0].goods_price));
									}
								},
								jianum: function () {
									if(this.s_shuliang >= this.max_sum){
										layer.msg('超出以购买数量');
									}else{
										this.s_shuliang ++;
										this.s_price =toDecimal(Number(this.s_price)+Number(data.data[0].goods_price));
									}
								},
							}
						});
					}else{
						layer.msg(data.message);
						if(data.code==0){
							setTimeout("javascript:location.href='{APP_PATH}index.php?m=zymember&c=index&a=login'",1000);
						}
					}
				});
				upload.render({
					elem: '#upload_img'
					, url: 'index.php?m=zymember&c=api&a=uploadfile_user'
					, multiple: true //多文件传送
					, number:6
					,accept: 'images'
					,bindAction:'#btn'
					,auto: false//是否自动上传
					,choose: function (obj) {
						//将每次选择的文件追加到文件队列
						var files = this.files = obj.pushFile();
						var index = $("#demo>.layui-row>.layui-col-xs3").size();
						console.log($("#demo>.layui-row>.layui-col-xs3"));
						var data  = Object.keys(files);
						len = data.length;
						if(Number(len) + Number(index) <= 6 )//最多上传图片量
						{
							$('#btn').click();
							console.log(1);
						}
						else
						{
							for(var i in data)
							{
								delete files[data[i]];
							}

							layer.msg("最多上传6张图片");
						}
						//预读本地文件示例，不支持ie8
						obj.preview(function (index, file, result) {

						});
					}
					, done: function (res, index, upload) {
						console.log(111111111111111111);
						$('#demo>.layui-row').prepend('<div class="layui-col-xs3 layui-col-sm3 layui-col-md3 " style="position: relative;"><span class="iconfont icon-quxiao del" style="position: absolute;top: 0;right: 0;width: 16px;height: 16px;color: #ff0000;z-index: 999999;background: #fff;border-radius: 50px;" ></span><input hidden name="shop['+id+'][photo][]" value='+res.msg+'> <img src="' + res.msg + '"  class="layui-upload-img" ></div>')
						delete this.files[index];
					}
				});
				$('#demo').on('click', '.del', function () {
					$(this).parent().remove();
				});
				$('#open_sel').on('click', function () {
					//页面层-自定义
					layer.open({
						type: 1,
						area: ['100%', 'auto'],
						offset: 'b',
						// closeBtn: 0,
						anim: 2,
						title: false, //不显示标题
						shadeClose: true,
						isOutAnim: false,
						scrollbar: true,
						move:true,
						fixed:false,
						content: '6666', //捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响
					});
				});


			}else{
				layer.msg('未获得订单号');
			}

			//给父页面传值
			$( "input[name$='goods_status']").on('click', function(){
				console.log($(this).val());
				if($(this).val()!=parent.$('.status').text()) {
					parent.$('.reason').text('请选择');
					parent.$('.reason').css("color","gray");
					$('.des').remove();
				}
				parent.$('.status').text($(this).val());
				parent.$('.status').css("color","black");
				parent.$('.status').parent().append('<input type="hidden" name="shop['+id+'][goodsType]" value='+$(this).val()+'>');
				layer.closeAll();
			});
			$( ".select2").on('click',"input[name$='tuikuan_reason']", function(){
				console.log($(this).val());
				parent.$('.reason').text($(this).val());
				parent.$('.reason').css("color","black");
				$('.des').remove();
				parent.$('.reason').parent().parent().append('<div class="des" style="display: inline-block" > <span >'+$(this).siblings(".none").text()+'</span> </div>');
				parent.$('.reason').parent().append('<input type="hidden" name="shop['+id+'][reason]" value='+$(this).val()+'>');
				layer.closeAll();

			});
        }();
		//制保留2位小数，如：2，会在2后面补上00.即2.00
		function toDecimal(x) {
			var f = parseFloat(x);
			if (isNaN(f)) {
				return false;
			}
			var f = Math.round(x*100)/100;
			var s = f.toString();
			var rs = s.indexOf('.');
			if (rs < 0) {
				rs = s.length;
				s += '.';
			}
			while (s.length <= rs + 2) {
				s += '0';
			}
			return s;
		}




	})

	</script>
</body>

</html>