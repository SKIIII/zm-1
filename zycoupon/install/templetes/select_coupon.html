<!doctype html>
<meta name="viewport" content="width=device-width, target-densitydpi=high-dpi" />
<html>
<head>
    <meta charset="utf-8">
    <title>红包</title>
    <link rel="stylesheet" type="text/css" href="{APP_PATH}statics/zm/css/style.css">
    <link rel="stylesheet" type="text/css" href="{APP_PATH}statics/zm/css/t-style.css">
    <link rel="stylesheet" type="text/css" href="https://at.alicdn.com/t/font_1119981_gdxu2g2gt8n.css">
    <script type="text/javascript" src="{APP_PATH}statics/zm/js/auto-size.js"></script>
    <script type="text/javascript" src="{APP_PATH}statics/zm/js/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="{APP_PATH}statics/zm/layer/layer.js"></script>
</head>
<style type="text/css">
.hb_radio{
    margin-top: 0.2rem;
    float: right;
    width: 22px;
    height: 22px;
    cursor: pointer;
    text-align: center;
    background-image: url(statics/images/check.png);
    background-repeat: no-repeat;
    background-size:100% 100%;
/*    background-position: -24px 0;*/
}
.hb_radio input{
    opacity: 0;
    cursor: pointer;
    -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";
    filter: alpha(opacity=0);
}
.hb_radio.on{
    background-image: url(statics/images/checker.png);
}
.hb-list{
    padding: 0 0.248rem;
}
.hb-con{
    background-color: #fff;
    padding: 0.248rem;
    border-radius: 5px;
    -webkit-box-shadow: 0 8px 32px rgba(105,123,140,.06);
    box-shadow: 0 8px 32px rgba(105,123,140,.06);
}
.hb-con .text1{
    float: left;
    width: 25%;
    text-align: center;
}
.hb-con .text1 h3{
    font-weight: bold;
    font-size: 0.6rem;
}
.hb-con .text1 p{
    font-size: 0.35rem;
    color: #888;
}
.hb-con .text2{
    float: left;
    width: calc(100% - 25% - 25px);
    padding: 0 25px;
}
.hb-con .text2 h3{
    font-size: 0.45rem;
    line-height: 0.7rem;
    font-weight: bold;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
}
.hb-con .text2 p{
    font-size: 12px;
    color: #666;
    overflow : hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
}
.hb-con .hb_radio{
    margin-top: 0.5rem;
}
</style>
<body style="background: #f1f1f1">
    <!--head_food-->
    <!--<div class='per-head'>-->
        <!--<div class='per-head-left'>-->
            <!--<a href='javascript:history.go(-1);'>-->
                <!--<img src='{APP_PATH}statics/zm/images/fh-b.png' class='tb-dw'>-->
            <!--</a>-->
        <!--</div>-->
        <!--<a class='per-head-hd'>选择优惠券</a>-->
        <!--<div class='per-head-right'>-->
        <!--</div>-->
        <!--<div class='clear'></div>-->
    <!--</div>-->
    <div  id="ky_coupon">
        <div class="bt10"></div>
        <div class="lh1 pl1 pr1 bg-fff md-fs">
            不使用红包
            <span class="hb_radio {if !$_GET[id]}on{/if}">
                <input @click="use(0)" name="nonuse" type="radio" id="nonuse" />
            </span>
            <div class="clear"></div>
        </div>
        <div class="bt10"></div>
        <div class="hb-list">
            <template v-for="k in data">
            <div class="hb-con">
                <div class="text1">
                    <h3 class="lh1 c-f5222d">￥{{k.minus}}</h3>
                    <template>
                        <p v-if="k.type == 0">无门槛</p>
                        <p v-else>满{{k.full}}元可用</p>
                    </template>
                </div>
                <div class="text2">
                    <h3>{{k.couponname}}</h3>
                    <p>
                        限{{k.begintime}}至{{k.endtime}}使用
                        <br>{{k.limittypename}}
                    </p>
                </div>
                <span v-if="k.id == '{$_GET[id]}'" class="hb_radio on" >
                    <input :class="k.id" @click="use(k.id)" name="nonuse" type="radio" />
                </span>
                <span v-else class="hb_radio" >
                    <input :class="k.id" @click="use(k.id)" name="nonuse" type="radio" />
                </span>
                <div class="clear"></div>
            </div>
            <div class="bt10"></div>
            </template>

            <!--<div class="hb-con">-->
                <!--<div class="text1">-->
                    <!--<h3 class="lh1 c-f5222d">￥7</h3>-->
                    <!--<p>满35元可用</p>-->
                <!--</div>-->
                <!--<div class="text2">-->
                    <!--<h3>品质联盟专享红包</h3>-->
                    <!--<p>-->
                        <!--限2019-05-13至2019-05-13使用-->
                        <!--<br>限收货手机号为123 1234 4567-->
                    <!--</p>-->
                <!--</div>-->
                <!--<span class="hb_radio">-->
                    <!--<input name="nonuse" type="radio" />-->
                <!--</span>-->
                <!--<div class="clear"></div>-->
            <!--</div>-->
            <!--<div class="bt10"></div>-->
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.21/dist/vue.js"></script>
    <script type="text/javascript" src="{APP_PATH}statics/public/js/leftTime.min.js"></script>
    <script src="{APP_PATH}statics/zm/js/ajax.js"></script>
    <script src="{APP_PATH}statics/public/layui-v2.4.5/layui/layui.all.js"></script>
    <script src="{APP_PATH}statics/public/swiper-4.4.6/dist/js/swiper.min.js"></script>
    <!--head_food_end-->
    <script>
            //由于模块都一次性加载，因此不用执行 layui.use() 来加载对应模块，直接使用即可：
        $(function() {
            !function () {

                var layer = layui.layer,
                        form = layui.form,
                        $ = layui.jquery,
                        upload = layui.upload,
                        table = layui.table;

                var userid = '{$_GET[_userid]}';
                var _catid = '{$_GET[_catid]}';
                var _total = '{$_GET[_total]}';
                var id = '{$_GET[id]}';
                //已兑换礼物列表
                aj.post('index.php?m=zycoupon&c=api&a=order_coupon_info', {
                    '_userid': userid,
                    '_catid': _catid,
                    '_total': _total
                }, function (data) {
                    //console.log(data.data);
                    if (data.status == 'error') {
                        if (data.code == -200) {
                            //setTimeout("javascript:location.href='{APP_PATH}index.php?m=zymember&c=index&a=login'", 1000);
                            $('#ky_coupon').append('<p style="text-align: center;font-size: small;padding-top: 0.5rem;color: grey">没有可用的优惠券</p>');
                        } else if (data.code == -1) {
                            layer.msg(data.message);
                            setTimeout("javascript:location.href='{APP_PATH}index.php?m=zymember&c=index&a=login'", 1000);
                        } else {
                            layer.msg(data.message);
                        }
                    } else {
                        console.log(data.data);
                        var ky_coupon = new Vue({
                            el: '#ky_coupon',
                            data: data,
                            methods: {
                                use: function (coupon_user_id) {
                                    // `this` 在方法里指向当前 Vue 实例
                                    console.log(coupon_user_id);
                                    $(".hb_radio").on("click", function () {
                                        $(".hb_radio").removeClass("on");
                                        $(this).toggleClass("on");
                                    });
                                    aj.post('index.php?m=zycoupon&c=api&a=api_coupon_select',{'_coupon_user_id':coupon_user_id},function(data){
                                        if (data.status == 'error') {
                                            if (data.code == -1) {
                                                layer.msg(data.message);
                                                setTimeout("javascript:location.href='{APP_PATH}index.php?m=zymember&c=index&a=login'", 1000);
                                            } else {
                                                layer.msg(data.message);
                                            }
                                        }else{
                                                //setTimeout("javascript:history.go(-1);", 0);
                                                //setTimeout("javascript:window.location.replace(document.referrer);", 0);
                                                window.parent.changeAddr("ss");
                                                var index = parent.layer.getFrameIndex(window.name);
                                                parent.layer.close(index);
                                        }
                                    })
                                }
                            }
                        })
                    }
                });

            }();
//
//            $(".hb_radio").on("click", function () {
//                $(".hb_radio").removeClass("on");
//                $(this).toggleClass("on");
//            })
        });
    </script>
</body>
</html>